<!doctype html>
<html>
<head>
  <%- include('template/head')%>
</head>

<body>
  <nav class="navbar">
    <div class="navbar__wrapper">
      <a class="navbar__site-name" href="/prize">Just A Bite!</a>
      <div class="navbar__list">
        <% if (isLogin) { %>
          <li><a href="/logout">登出</a></li>
        <% } else { %>
          <li><a href="/login">登入</a></li>
          <li><a href="/register">註冊</a></li>
        <% } %>
      </div>
    </div>
  </nav>
  <section class="image__banner">
    <h1>管理後臺</h1>
  </section>
  <div class="container-wrapper">
    <div class="container">
      <div class="table-container">
        <form action="/edit-odds" method="post">
          <table>
            <tr>
              <th>id</th>
              <th>名稱</th>
              <th>內容</th>
              <th>中獎機率</th>
              <th>編輯/刪除獎項</th>
            </tr>
            <% for (const prize of prizes) { %> 
              <tr>
                <td class="id-sample sample"><%= prize.id %></td>
                <td class="username-sample sample"><%= prize.name %></td>
                <td class="nickname-sample sample"><%= prize.desc %></td>
                <td class="nickname-sample sample"><input name="<%= prize.id %>" value="<%= prize.probability %>"></input></td>
                <td>
                  <a class="btn-edit" href="/edit?id=<%= prize.id %>">編輯</a>
                  <a class="btn-delete" href="/delete?id=<%= prize.id %>">刪除</a>
                </td>
              </tr>
            <% } %>
          </table>
          <button class="btn-prob" type="submit">更新中獎機率</button>
        </form>
      </div>
      <hr>
      <div class="upload__wrapper">
        <h2>新增獎項</h2>
        <% if (errorMessage && errorMessage.length > 0) { %>
          <div class="errmsg"><%= errorMessage %></div>
        <% } %>
        <form class="upload__form" action="/create" method="post" enctype="multipart/form-data">
          <div>
            <label for="name">獎項名稱：</label>
            <input class="form-control" type="text" id="name" name="name" />
          </div>
          <div>
            <label for="prob">中獎機率：</label>
            <input class="form-control" name="probability" id="prob" type="number" step="0.01" min="0" max="1" placeholder="請填 0~1" />
          </div>
          <div>
            <label for="desc">獎項描述：</label>
            <textarea class="form-control" name="desc" id="desc"></textarea>
          </div>
          <div>
            <label for="upload">選擇上傳圖檔：</label>
            <input id="upload" type="file" name="upload">
          </div>
          <div>
            <button class="btn btn-create" type="submit">上傳</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <%- include('template/footer')%>
</body>
<script src="index.js"></script>
<script>
  // 清除錯誤訊息
  const delegation = document.querySelector('.upload__wrapper')
  if (document.querySelector('.errmsg')) {
    const errmsg = document.querySelector('.errmsg')
    focusinRemoveErrmsg(delegation, errmsg)
  }
</script>
</html>