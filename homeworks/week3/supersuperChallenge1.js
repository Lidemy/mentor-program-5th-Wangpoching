function arrayEquals(a, b) {
  return Array.isArray(a) &&
    Array.isArray(b) &&
    a.length === b.length &&
    a.every((val, index) => val === b[index])
}

function mazeDonut(data, width, height, xThick, yThick) {
  const maze = convertDataToMaze(data, width, height, xThick, yThick)
  const { map, portals } = maze
  let counter = 0
  const entryPoint = portals['AA'] // eslint-disable-line dot-notation
  let routes = entryPoint
  let temp = []
  while (true) {
    for (const ele of routes) {
      const [row, col] = ele
      const current = map[row][col]
      if (current === 'ZZ') return counter
      if (current !== '.' && current !== 'x' && current !== '#' && current !== 'AA') {
        const portalOPtions = portals[`${current}`]
        const transport = portalOPtions[portalOPtions.findIndex((ele) => !arrayEquals(ele, [row, col]))]
        temp.push(transport)
        delete portals[`${current}`]
        map[row][col] = 'x'
        map[transport[0]][transport[1]] = 'x'
        continue
      }
      map[row][col] = 'x'
      // 右
      const currentRight = map[row][col + 1]
      if (currentRight === '.') {
        temp.push([row, col + 1])
      }
      // 下
      const currentBottom = map[row + 1][col]
      if (currentBottom === '.') {
        temp.push([row + 1, col])
      }
      // 左
      const currentLeft = map[row][col - 1]
      if (currentLeft === '.') {
        temp.push([row, col - 1])
      }
      // 上
      const currentTop = map[row - 1][col]
      if (currentTop === '.') {
        temp.push([row - 1, col])
      }
    }
    counter += 1
    routes = [...temp]
    console.log(routes)
    temp = []
  }
}

function convertDataToMaze(data, width, height, xThick, yThick) {
  function isLabel(target) {
    return target === 'x' || target === '.' || target === '#'
  }
  function appendKey(container, key, value) {
    if (key in container) {
      container[key].push(value)
      return
    }
    container[key] = [value]
  }
  function appendPortals({ map, portals }) {
    const nRow = map.length
    const nCol = map[0].length

    // Top
    for (let i in map[0]) {
      i = Number(i)
      if (!isLabel(map[0][i]) && !isLabel(map[1][i])) {
        const portalName = `${map[0][i]}${map[1][i]}`
        map[2][i] = portalName
        appendKey(portals, portalName, [2, i])
        map[0][i] = 'x'
        map[1][i] = 'x'
      }
      if (!isLabel(map[yThick + 2][i]) && !isLabel(map[yThick + 3][i])) {
        const portalName = `${map[yThick + 2][i]}${map[yThick + 3][i]}`
        map[yThick + 1][i] = portalName
        appendKey(portals, portalName, [yThick + 1, i])
        map[yThick + 2][i] = 'x'
        map[yThick + 3][i] = 'x'
      }
    }

    // Bottom
    for (let i in map[0]) {
      i = Number(i)
      if (!isLabel(map[nRow - 2][i]) && !isLabel(map[nRow - 1][i])) {
        const portalName = `${map[nRow - 2][i]}${map[nRow - 1][i]}`
        map[nRow - 3][i] = portalName
        appendKey(portals, portalName, [nRow - 3, i])
        map[nRow - 2][i] = 'x'
        map[nRow - 1][i] = 'x'
      }
      if (!isLabel(map[nRow - 3 - yThick][i]) && !isLabel(map[nRow - 4 - yThick][i])) {
        const portalName = `${map[nRow - 4 - yThick][i]}${map[nRow - 3 - yThick][i]}`
        map[nRow - 2 - yThick][i] = portalName
        appendKey(portals, portalName, [nRow - 2 - yThick, i])
        map[nRow - 3 - yThick][i] = 'x'
        map[nRow - 4 - yThick][i] = 'x'
      }
    }

    // Left
    for (let i = 0; i < nRow; i++) {
      if (!isLabel(map[i][0]) && !isLabel(map[i][1])) {
        const portalName = `${map[i][0]}${map[i][1]}`
        map[i][2] = portalName
        appendKey(portals, portalName, [i, 2])
        map[i][0] = 'x'
        map[i][1] = 'x'
      }
      if (!isLabel(map[i][2 + xThick]) && !isLabel(map[i][3 + xThick])) {
        const portalName = `${map[i][2 + xThick]}${map[i][3 + xThick]}`
        map[i][1 + xThick] = portalName
        appendKey(portals, portalName, [i, 1 + xThick])
        map[i][2 + xThick] = 'x'
        map[i][3 + xThick] = 'x'
      }
    }

    // Right
    for (let i = 0; i < nRow; i++) {
      if (!isLabel(map[i][nCol - 2]) && !isLabel(map[i][nCol - 1])) {
        const portalName = `${map[i][nCol - 2]}${map[i][nCol - 1]}`
        map[i][nCol - 3] = portalName
        appendKey(portals, portalName, [i, nCol - 3])
        map[i][nCol - 2] = 'x'
        map[i][nCol - 1] = 'x'
      }
      if (!isLabel(map[i][nCol - 3 - xThick]) && !isLabel(map[i][nCol - 4 - xThick])) {
        const portalName = `${map[i][nCol - 4 - xThick]}${map[i][nCol - 3 - xThick]}`
        map[i][nCol - 2 - xThick] = portalName
        appendKey(portals, portalName, [i, nCol - 2 - xThick])
        map[i][nCol - 3 - xThick] = 'x'
        map[i][nCol - 4 - xThick] = 'x'
      }
    }
  }

  const maze = {
    map: Array(height + 4).fill(null).map((row) => Array(width + 4).fill(null)),
    portals: {}
  }
  const { map } = maze
  for (let j = 0; j < (height + 4); j++) {
    for (let i = 0; i < (width + 4); i++) {
      const current = data[(width + 4) * j + i]
      map[j][i] = current === ' ' ? 'x' : current
    }
  }
  // 填通道
  appendPortals(maze)
  console.log(maze.portals)
  return maze
}

/*
const data = `
xxxxxxxxxAxxxxxxxxxxx
xxxxxxxxxAxxxxxxxxxxx
xx#######.#########xx
xx#######.........#xx
xx#######.#######.#xx
xx#######.#######.#xx
xx#######.#######.#xx
xx#####  B    ###.#xx
BC...##  C    ###.#xx
xx##.##       ###.#xx
xx##...DE  F  ###.#xx
xx#####    G  ###.#xx
xx#########.#####.#xx
DE..#######...###.#xx
xx#.#########.###.#xx
FG..#########.....#xx
xx###########.#####xx
xxxxxxxxxxxxxZxxxxxxx
xxxxxxxxxxxxxZxxxxxxx
`
const data2 = `
xxxxxxxxxxxxxxxxxxxAxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxAxxxxxxxxxxxxxxx
xx#################.#############xx
xx#.#...#...................#.#.#xx
xx#.#.#.###.###.###.#########.#.#xx
xx#.#.#.......#...#.....#.#.#...#xx
xx#.#########.###.#####.#.#.###.#xx
xx#.............#.#.....#.......#xx
xx###.###########.###.#####.#.#.#xx
xx#.....#        A   C    #.#.#.#xx
xx#######        S   P    #####.#xx
xx#.#...#                 #......VT
xx#.#.#.#                 #.#####xx
xx#...#.#               YN....#.#xx
xx#.###.#                 #####.#xx
DI....#.#                 #.....#xx
xx#####.#                 #.###.#xx
ZZ......#               QG....#..AS
xx###.###                 #######xx
JO..#.#.#                 #.....#xx
xx#.#.#.#                 ###.#.#xx
xx#...#..DI             BU....#..LF
xx#####.#                 #.#####xx
YN......#               VT..#....QG
xx#.###.#                 #.###.#xx
xx#.#...#                 #.....#xx
xx###.###    J L     J    #.#.###xx
xx#.....#    O F     P    #.#...#xx
xx#.###.#####.#.#####.#####.###.#xx
xx#...#.#.#...#.....#.....#.#...#xx
xx#.#####.###.###.#.#.#########.#xx
xx#...#.#.....#...#.#.#.#.....#.#xx
xx#.###.#####.###.###.#.#.#######xx
xx#.#.........#...#.............#xx
xx#########.###.###.#############xx
xxxxxxxxxxxBxxxJxxxCxxxxxxxxxxxxxxx
xxxxxxxxxxxUxxxPxxxPxxxxxxxxxxxxxxx
`
*/

const data3 = `
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxGxFxxxxxxxxxZxxxTxxxxxYxxxCxxxxxxxxxYxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxExZxxxxxxxxxZxxxQxxxxxIxxxTxxxxxxxxxXxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xx#################################.#.#########.###.#####.###.#########.###############################xx
xx#...#.................#...#...#...#.....#...#.....#.....#.#.#.#...#.#...#...#.#.#.#.#...#.#.....#.#.#xx
xx#.#############.#.###.#.###.#####.###.#####.#####.#.#####.#.#.#.###.#.#.#.###.#.#.#.#.#.#.###.###.#.#xx
xx#.#.#.#...#.....#.#.........#.#...#.....#.#.......#.......#.......#...#.#...#.......#.#.#.#.#...#...#xx
xx#.#.#.#.#######.#######.###.#.#.#.###.###.#.###.#########.###.#.#####.###.###.#########.#.#.#.#####.#xx
xx#...#...#.#...#.#.......#.......#.#.#.#.#.....#.#.........#...#.....#.........#.#.....#.#.#.........#xx
xx###.###.#.#.#####.#.#######.#.###.#.#.#.###.#######.#####.#######.#####.#######.#.###.#.#.#.#########xx
xx#.........#.#...#.#...#.#...#.#.#.#.#.....#.....#.#.....#...#...#...#...........#.#.#.#...#.........#xx
xx#########.#.###.#######.#######.#.#.###.#######.#.#.#.###.#####.#.###.#########.###.#.#.###.#######.#xx
xx#...#.#.#.........#.......#.#...#.#...#...#.......#.#...#.....#.....#...#.....#...#.#.#...#...#...#.#xx
xx#.###.#.#.###.#######.###.#.###.#.#.#.#.###.###.#####.###.#.#####.###.#.#.#########.#.#.###.###.#####xx
xx#.....#.....#.#.#.#.#...#...#.....#.#.....#.#.#.#.#...#...#.#.....#.#.#.......#.......#.....#...#...#xx
xx###.###.#######.#.#.#####.#.#####.#.#######.#.###.#.#.###.#.#####.#.###.#.###.###.#.#.#.#######.#.###xx
xx#.....#.....#.......#...#.#.#.....#.....#...#.....#.#...#.#.#...#.....#.#...#.#.#.#.#.#.#.....#.#...#xx
xx#.#.#.#.###########.###.###.#####.#.#######.###.###.###.#####.###.#.###.###.###.#.#####.#.#####.#.###xx
xx#.#.#.......#.#.........#.#.#.#.#.#.#.#.....#.....#...#.#.........#.#.....#...#...#.#...#.#...#...#.#xx
xx#.#####.#####.#####.#.#.#.#.#.#.#.#.#.#####.###.###.###########.#######.#.#.#.###.#.###.#.###.#.#.#.#xx
xx#.#.#.#...#.#...#.#.#.#.....#.#.#.#...#.....#.#...#...#.#.#.......#.#.#.#.#.#.#.#.....#.....#...#.#.#xx
xx###.#.#.###.#.###.###.#.###.#.#.#.#.#.#.###.#.#.###.###.#.#####.#.#.#.#.#######.#.#####.#######.###.#xx
xx#.....#.....#.#.....#.#.#.......#.#.#.#.#.#.......#.#.....#.....#.#...#...........#...........#.#...#xx
xx###.#.#.#.###.#####.#######.###.#.#.#####.#.#####.#.#.#####.#.#.###.#.#.###.#.#########.#.#####.#.#.#xx
xx#.#.#.#.#.#.#.....#.....#.....#...#.......#.#.....#.#.....#.#.#.#.#.#.....#.#.#.....#...#...#...#.#.#xx
xx#.###.#.###.###.###.#.#.#####.#.#.#.#####.###.#####.###.#######.#.#.#.#.###########.###.#####.#.#.###xx
xx#.#.........#.#.#.#.#.#.#.....#.#.#.#.....#.......#.......#.......#.#.#.......#.#.#.#.#...#...#.#...#xx
xx#.#####.#.###.#.#.#.###.#####.#######.#########.#######.#########.#.###########.#.#.#.###.#####.#.###xx
xx#...#...#...#.....#.#.#.#    L       K         T       O         G V        #.#.#.#.....#...#.#.....#xx
xx###.###.#########.###.#.#    I       L         X       K         E Y        #.#.#.#.#####.###.#.#####xx
xx#.........#...#.........#                                                   #.............#...#.#...#xx
xx###.#.#######.###.#.#.#.#                                                   #.###.#.#.#.#.#.#.#.#.###xx
NA..#.#.#...#.#...#.#.#.#..ZV                                                 #...#.#.#.#.#...#.....#.#xx
xx#.#.#.#.###.#.#.#.#.#.###                                                   ###.#.#####.#######.###.#xx
xx#.#.#.#.....#.#.#.#.#...#                                                   #...#.#...#...#...#.#.#..EH
xx#.#.#.#.#.###.#########.#                                                   #.#.###.###.###.###.#.#.#xx
xx#...#...#...............#                                                 PB..#.#.#...#.#...#.#.....#xx
xx###.#.#####.#####.#######                                                   #####.#.#######.#.#.#####xx
xx#...#.#.....#.....#.....#                                                 YX..........#.#...#.#.#.#.#xx
xx###.#########.#.#.#.###.#                                                   #.#.###.###.#.#.#.###.#.#xx
xx#.......#.#...#.#.#...#.#                                                   #.#.#.#.......#...#...#.#xx
xx#.#######.#########.###.#                                                   #####.#.#####.###.#.###.#xx
xx#.#.#.#.#...........#....HM                                                 #.#...#...#.#.#.......#..KL
xx###.#.#.#.###.#####.###.#                                                   #.###.#####.#.#####.###.#xx
ZV..........#.....#.#...#.#                                                   #.#.#...#...#...#.#.....#xx
xx#############.#.#.#.###.#                                                   #.#.#.###.#######.#####.#xx
YB..........#...#...#.#...#                                                   #.....#.....#...#...#...#xx
xx###.###.#######.#########                                                   #.###.###.#.#.###.#.#####xx
xx#...#.....#.....#.#...#.#                                                 HP....#...#.#.......#.#....XC
xx#.#.#####.#######.###.#.#                                                   #.###.#.#.###.#.###.#.###xx
xx#.#.#.#.........#.#.#.#..TQ                                                 #.#.#.#...#...#.#.....#.#xx
xx#####.#####.#.###.#.#.#.#                                                   ###.###################.#xx
xx#.#.......#.#...........#                                                   #.#.....................#xx
xx#.#####.#################                                                   #.#.###.#.###.###.###.###xx
xx#.#......................GY                                               QD..#...#.#...#...#.#...#.#xx
xx#.###.#.#.#####.###.###.#                                                   #.###.#.#.###.###.#.#.#.#xx
xx#.....#.#.#.......#...#.#                                                   #.#...#.#.#...#...#.#.#..VY
xx###.###########.###.#.###                                                   #.#.#.#######.#######.#.#xx
xx#.#...........#...#.#...#                                                   #...#.....#.....#.......#xx
xx#.###.#.###########.###.#                                                   #################.###.###xx
LA......#.#.....#.#.....#.#                                                   #.......#.#...#.#...#...#xx
xx#####.###.#.###.#########                                                   #.###.###.#.###.#########xx
PB....#...#.#.#.....#.#.#..YI                                               LA..#...#.#.....#...#.#.#..AA
xx#.###.#.#.#####.###.#.#.#                                                   ###.###.#.#.###.###.#.#.#xx
xx#...#.#.#...#.....#.....#                                                   #.#.....#.#.#.....#.....#xx
xx#.#######.#####.###.###.#                                                   #.#.###.###.#.#.#####.#.#xx
xx#.#.....#.#.#.#...#...#.#                                                   #.#...#.......#.......#..QD
xx#.#.#.###.#.#.#.###.###.#                                                   #.#######.#.#####.#.#####xx
xx#...#...............#.#.#                                                 UC..#.....#.#.#.#.#.#.#.#..XV
xx#####.###############.###                                                   #.#.###.#####.#.###.#.#.#xx
xx#...#.#...........#.....#                                                   #.#...#...#.....#.#.#...#xx
xx#.#.###.#.#.#.#.#.###.###                                                   #.###.###.###.#.#.###.#.#xx
HP..#.....#.#.#.#.#........YB                                                 #.....#.......#.......#.#xx
xx#####.#.#####.#.#.#######                                                   ###########.#.#####.#.###xx
LI....#.#.....#.#.#.#......XC                                               XV........#...#.#.#.#.#.#.#xx
xx#.#####.#.#########.###.#                                                   #.#####.###.###.#.###.#.#xx
xx#...#.#.#.#.....#.#.#...#                                                   #.#.......#...#.#...#.#.#xx
xx#.###.#####.#.###.#.#####                                                   ###.#######.###.#.#####.#xx
xx#...#...#.#.#.....#.....#                                                   #...#...#.#.#.......#.#..HM
xx###.#.#.#.###.#.#######.#                                                   #.###.#.#.###.#.#####.#.#xx
xx#.....#.......#.........#                                                   #.....#.......#.........#xx
xx###.#.###.###.#.#.###.#.#        N     E     F   C     X   T           T    ###.#####.#####.#.#####.#xx
xx#...#...#.#...#.#.#...#.#        A     H     Z   T     O   Y           N    #.......#...#...#.#.....#xx
xx#.###.#####.#####.#.#.###########.#####.#####.###.#####.###.###########.#####.#.#.#########.#######.#xx
xx#.#.....#...#.....#.#.#...........#.....#...#.....#.....#.........#.........#.#.#.....#.....#.#...#.#xx
xx#####.#####.###.#########.#.#######.#####.#.###.###.#######.#.#######.###.#####.#############.###.#.#xx
xx#.#.#...#.....#.#.......#.#.....#.#.......#.#.#.#.#.....#.#.#.#.....#.#.......#.......#.............#xx
xx#.#.#.###.###.#.#####.#####.#.###.#######.###.#.#.#####.#.###.###.###.###.#.#.#.#.#######.#.###.###.#xx
xx#.......#...#.#.#...........#.#.#...#...#...#.......#...#...#.....#.#.#.#.#.#.#.#...#.....#.#...#...#xx
xx###.#####.###.#######.#.###.###.###.#.#.#.#####.#.#####.#.#####.###.###.#.###.#############.#######.#xx
xx#.#.#.......#.#...#...#.#.....#.#.....#...#.#...#.#...#...#.#.........#...#...#.#...#.#.#...#.#.....#xx
xx#.#.#.###.#####.#.###.#######.#.#.#.###.#.#.#####.###.###.#.###.###.#####.###.#.#.#.#.#.###.#.###.#.#xx
xx#...#.#...#.#...#.#.....#.......#.#.#.#.#.#.......#.#.......#...#...#.......#.#.#.#.#...........#.#.#xx
xx###.###.#.#.#.###.###.#####.#######.#.###.#.#.###.#.###.#.#####.#######.#######.#.#########.#####.#.#xx
xx#.....#.#.#...#.......#.......#.......#.#.#.#...#...#.#.#.#...#...#.......................#.#.....#.#xx
xx###.#################.#####.#######.###.#####.###.###.#.###.#####.#######.#.#####.#.###.###.#####.#.#xx
xx#.....#.#.....#.........#.#.....#...#.#.#.#.#.#.......#...#.....#.#.#.....#.#.#.#.#...#.#.....#...#.#xx
xx###.#.#.###.#.#.#########.#####.###.#.#.#.#.###.###.#####.#.###.#.#.###.#####.#.#########.#.###.###.#xx
xx#.#.#.#.#.#.#...#.#.............#.#.#...#.........#.#...#.#.#.#...#...............#.#.#...#...#...#.#xx
xx#.#####.#.###.###.###.###.#.#.#.#.#.###.#########.###.###.#.#.###.#.###.###########.#.###.#####.#.###xx
xx#.....#.......#.......#...#.#.#.#.#.....#...#.#.....#.....#...#.#.#...#...#...........#.......#.#...#xx
xx#.###.###.#####.#.#.#####.#.###.#.#.#######.#.###.#####.#.#.#.#.###.#######.#######.#####.#####.#####xx
xx#.#...#.#.#.....#.#.#.....#.#...#...#.#...........#.....#.#.#.....#.#...#.........#.#.#.......#.....#xx
xx#####.#.#.###.#.#######.#.#.#######.#.#####.#####.#######.#.#.#####.#.#####.#########.###.#.###.###.#xx
xx#.........#.#.#...#...#.#.#.#.....#.......#.....#.#...#.#.#.#.#...#...#...#.#...#...#.....#.#...#...#xx
xx###.#.#.#.#.#.#.###.#.#####.#####.#.###.#.#####.###.###.#.###.###.#.###.###.#.###.###.#.###.###.#.#.#xx
xx#...#.#.#.#...#.#...#...........#.....#.#.....#.......#.....#...#...................#.#.#...#...#.#.#xx
xx#############################.###########.#####.#.#######.###.###########.###########################xx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxTxxxxxxxxxxxTxxxxxOxTxxxxxxxUxxxGxxxxxxxxxxxXxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxXxxxxxxxxxxxNxxxxxKxYxxxxxxxCxxxYxxxxxxxxxxxOxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
`

// const cleanData = data.replace(/\n|\r/g, '')
// const cleanData2 = data2.replace(/\n|\r/g, '')
const cleanData3 = data3.replace(/\n|\r/g, '')

console.log(mazeDonut(cleanData3, 101, 105, 25, 25))
